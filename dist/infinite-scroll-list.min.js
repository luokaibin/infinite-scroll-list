!function(){"use strict";class e extends HTMLElement{constructor(){super(),this._observerRef=null,this._resizeObserverRef=null,this._bottomRef=null,this._scrollContainer=null,this._onEndReachedThreshold=0,this._hasNextPage=!1,this._refreshContainer=null,this._enableRefresh=!1,this._refreshThreshold=60,this._isRefreshing=!1,this._startY=0,this._isPulling=!1,this._isScrollingToTop=!1,this._intersectionCallback=e=>{const[s]=e;s.isIntersecting&&(this._isScrollingToTop||this._hasNextPage&&this.dispatchEvent(new CustomEvent("end-reached",{bubbles:!0,composed:!0})))},this._resizeCallback=e=>{const s=this._findScrollContainer();s!==this._scrollContainer&&(this._cleanupRefreshListeners(),this._setupObserver(s),this._enableRefresh&&this._isMobile&&this._setupRefreshListeners())},this._handleTouchStart=e=>{if(!this._enableRefresh)return;if(this._isRefreshing)return;let s;s=this._scrollContainer?this._scrollContainer.scrollTop:document.documentElement.scrollTop||document.body.scrollTop||0,s<=0&&(this._startY=e.touches[0].pageY,this._isPulling=!0,this._refreshContainer&&(this._refreshContainer.style.transition="none"))},this._handleTouchMove=e=>{if(!this._isPulling||!this._refreshContainer)return;const s=e.touches[0].pageY-this._startY;if(s>0){e.cancelable&&e.preventDefault();const t=2*this._refreshThreshold,n=Math.min(Math.pow(s,.85),t);this._refreshContainer.style.height=`${n}px`,this.dispatchEvent(new CustomEvent("refresh-pulling",{bubbles:!0,composed:!0,detail:{distance:n,threshold:this._refreshThreshold,progress:Math.min(n/this._refreshThreshold,1)}}))}},this._handleTouchEnd=e=>{if(!this._isPulling||!this._refreshContainer)return;this._isPulling=!1,this._refreshContainer.style.transition="height 0.3s ease";(parseFloat(this._refreshContainer.style.height)||0)>=this._refreshThreshold?(this._refreshContainer.style.height=`${this._refreshThreshold}px`,this._triggerRefresh()):this._refreshContainer.style.height="0"},this.attachShadow({mode:"open"}).innerHTML='\n<style>\n  :host {\n    display: block;\n    width: 100%;\n    height: 100%;\n    overscroll-behavior-y: contain;\n  }\n\n  .bottom-ref {\n    width: 0;\n    height: 0;\n    pointer-events: none;\n  }\n\n  /* 状态驱动 UI：利用 CSS 选择器响应属性变化 */\n  .slot-wrapper {\n    display: none;\n  }\n  :host([has-next-page="true"]) .loading-slot {\n    display: contents;\n  }\n  :host([has-next-page="false"]) .no-data-slot {\n    display: contents;\n  }\n\n  .refresh-container {\n    overflow: hidden;\n    height: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: height 0.3s ease;\n    flex-shrink: 0;\n    background-color: transparent;\n  }\n</style>\n\n<div class="refresh-container">\n  <slot name="refresh"></slot>\n</div>\n<slot></slot>\n<div class="bottom-ref"></div>\n<div class="slot-wrapper loading-slot">\n  <slot name="loading"></slot>\n</div>\n<div class="slot-wrapper no-data-slot">\n  <slot name="no-data"></slot>\n</div>\n',this._bottomRef=this.shadowRoot.querySelector(".bottom-ref"),this._refreshContainer=this.shadowRoot.querySelector(".refresh-container")}static get observedAttributes(){return["on-end-reached-threshold","has-next-page","enable-refresh","refresh-threshold","is-refreshing"]}attributeChangedCallback(e,s,t){if(s!==t)if("on-end-reached-threshold"===e)this._onEndReachedThreshold=Number(t)||0,this._bottomRef&&(this._bottomRef.style.transform=`translateY(${-this._onEndReachedThreshold}px)`);else if("has-next-page"===e)this._hasNextPage=null!==t&&"false"!==t;else if("enable-refresh"===e)this._enableRefresh=null!==t&&"false"!==t,this._enableRefresh&&this._isMobile?this._setupRefreshListeners():this._cleanupRefreshListeners();else if("refresh-threshold"===e)this._refreshThreshold=Number(t)||60;else if("is-refreshing"===e){const e=this._isRefreshing;this._isRefreshing=null!==t&&"false"!==t,e&&!this._isRefreshing&&this._refreshContainer&&(this._refreshContainer.style.height="0")}}connectedCallback(){const e=this._findScrollContainer();this._setupObserver(e),this._resizeObserverRef=new ResizeObserver(this._resizeCallback),this.parentElement&&this._resizeObserverRef.observe(this.parentElement),this._enableRefresh&&this._isMobile&&this._setupRefreshListeners()}disconnectedCallback(){this._observerRef&&(this._observerRef.disconnect(),this._observerRef=null),this._resizeObserverRef&&(this._resizeObserverRef.disconnect(),this._resizeObserverRef=null),this._cleanupRefreshListeners()}_findScrollContainer(){let e=this;for(;e;){const{overflowY:s}=window.getComputedStyle(e);if(["auto","scroll"].includes(s))return e;e=e.parentElement}return null}_setupObserver(e){this._scrollContainer=e,this._observerRef&&this._observerRef.disconnect(),this._observerRef=new IntersectionObserver(this._intersectionCallback,{threshold:0,root:e}),this._bottomRef&&this._observerRef.observe(this._bottomRef)}get _isMobile(){return"ontouchstart"in window||navigator.maxTouchPoints>0}_setupRefreshListeners(){if(!this._isMobile)return;const e=this._scrollContainer||document.body;e.addEventListener("touchstart",this._handleTouchStart,{passive:!0}),e.addEventListener("touchmove",this._handleTouchMove,{passive:!1}),e.addEventListener("touchend",this._handleTouchEnd)}_cleanupRefreshListeners(){const e=this._scrollContainer||document.body;e.removeEventListener("touchstart",this._handleTouchStart),e.removeEventListener("touchmove",this._handleTouchMove),e.removeEventListener("touchend",this._handleTouchEnd)}async scrollToTopAndRefresh(){if(this._enableRefresh&&!this._isRefreshing&&!this._isScrollingToTop){this._isScrollingToTop=!0;try{const e=this.scrollToTop();this._triggerRefresh(),await e}finally{setTimeout((()=>{this._isScrollingToTop=!1}),300)}}}scrollToTop(){return new Promise((e=>{(this._scrollContainer||window).scrollTo({top:0,behavior:"smooth"});const s=setTimeout(e,1e3),t=()=>{(this._scrollContainer?this._scrollContainer.scrollTop:document.documentElement.scrollTop||document.body.scrollTop||0)<=1?(clearTimeout(s),e()):requestAnimationFrame(t)};requestAnimationFrame(t)}))}_triggerRefresh(){this._refreshContainer&&(this._refreshContainer.style.height=`${this._refreshThreshold}px`,this._isRefreshing=!0,this.setAttribute("is-refreshing","true"),this.dispatchEvent(new CustomEvent("refresh",{bubbles:!0,composed:!0})))}}customElements.define("infinite-scroll-list",e)}();
//# sourceMappingURL=infinite-scroll-list.min.js.map
